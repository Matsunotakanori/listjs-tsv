<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
  <!-- ulのリスト先頭の「・」を非表示にする またリストを横に並べる -->
  <link media="all" href="css/4listjs.css" type="text/css" rel="stylesheet">
  <title>lits.jsとtsvによる静的な図書館関係本リストのテスト</title>
</head>
<body class="container">
  <h1>list.jsとtsvによる静的な図書館関係本リスト「１万件」チャレンジ</h1>
  Code は<a href="https://github.com/maedaak/listjs-tsv/" target="_blank">こちら</a>にある。
  開発の詳細は<a href="https://github.com/maedaak/listjs-tsv/wiki" target="_blank">Wiki</a>に記載している。
  <!-- list.jsのブロック idはlist.jsの呼び出しに使う　HTML末尾のスクリプトで指定している -->
  <div id="listdata">
    <div class="form-group">
      <label for="keyword">文字列をタイプ　<span class="alert">※　半角スペース区切りでAND検索可能</span></label>
      <!-- classをsearchにし、list.jsの検索欄に -->
      <input id="keyword" class="search form-control form-control-lg" placeholder="input any word" size="50" />
      言語: <select id="lang" onChange="List();">
        <option value="any"> --- </option>
        <option value="eng">英語</option>
        <option value="ger">ドイツ語</option>
        <option value="chi">中国語</option>
      </select>
      <span id="hits"></span>
    </div>
    <!-- classをpaginationにし、list.jsのページネーションに -->
    <div class="form-group">
      <ul class="pagination list-inline">
      <!-- <div style="display:none;"> -->
        <li id="list-item">
          <dl>
            <dt class="title"></dt>
            <dd class="creator"></dd>
            <dd class="publisher"></dd>
            <dd class="ncid"></dd>
            <dd class="edition"></dd>
            <dd class="publicationDate"></dd>
            <dd class="note"></dd>
          </dl>
        </li>
      <!-- </div> -->
       </ul>
    </div>
    <br>
    <!--
      図書リスト
         <ul>のclassをlist.js指定の"list"にすることで処理が働く
         classは任意設定　これによりlist.jsの絞り込み対象を指定 HTML末尾のスクリプトで指定している
    -->
    <ul class="list list-unstyled">
    </ul>
  </div>
  <hr>
  <footer>
    <h2>目録データのソースについて</h2>
    このページで使っているサンプル図書リストは、国立情報学研究所の「NII総合目録データベース（NACSIS-CAT）」<a href="https://creativecommons.org/licenses/by/4.0/deed.ja" target="_blank">(CC-BYライセンス)</a>を元にしています。
    <br>
    <strong>「図書館」</strong>に関する書誌データを60件程度抜粋して使いました。
  </footer>
<!-- list.js スクリプトの記述 -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/list.js/2.3.1/list.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/list.fuzzysearch.js/0.1.0/list.fuzzysearch.min.js"></script>
<script src = "https://d3js.org/d3.v4.min.js"></script>
<script>
    d3.tsv("cat10000.tsv", function(error, values) {
    // fuzzy serch設定
    var fuzzyOptions = {
      searchClass: "fuzzy-search",
      location: 0,
      distance: 100,
      threshold: 0.4,
      multiSearch: true
　  };
    // List.jsの動作パラメータ設定
    var options = {
      // 対象とするclass を指定
      valueNames: ['title', 'creator', 'publisher', 'ncid', 'language', 'edition', 'note'],
      item: 'list-item',
      // fuzzy search
      plugins: [
        ListFuzzySearch(fuzzyOptions)
    　],
      searchDelay: 750,
      // ページネーション指定 pageはページごとの表示件数
      page: 20,
      pagination: {
        paginationClass: 'pagination',
        innerWindow: 4,
        outerWindow: 1,
      }
    };
    // list.jsの対象とする<div>のidを指定
    var listObj = new List('listdata', options, values);
    // iOS対応のため、inputイベントで動作させる。併せてヒット件数を表示させる。
    $('#keyword').on('input', function() {
      var searchString = $(this).val();
      listObj.search(searchString);
      $('#hits').html(listObj.matchingItems.length + "件ヒットしました");
    });
    // 言語フィルター
    $('#lang').change(function() {
      lang = $('option:selected').val();
      listObj.filter(function(item) {
        if (lang === 'any') {
          return true;
        }
        else if (item.values().language.indexOf(lang) > -1) {
          return true;
        }
        else {
          return false;
        }
      });
      return false;
    });
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js" integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj" crossorigin="anonymous"></script>
</body>
</html>
